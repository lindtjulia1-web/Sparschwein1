<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank Pro Editor</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 400px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 20px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 15px; margin-bottom: 10px; position: relative; }
        label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        input, select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 8px; margin-top: 4px; box-sizing: border-box; font-size: 13px; }
        .btn { border: none; padding: 14px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; } 
        .btn-code { background: #77dd77; color: #000; } 
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; padding: 40px; }
        #device-wrapper { position: relative; transition: 0.3s; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border-radius: 20px; font-family: monospace; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Настройки Экрана</h2>
        <div class="color-grid">
            <div><label>Ширина</label><input type="number" id="width" value="400"></div>
            <div><label>Высота</label><input type="number" id="height" value="600"></div>
        </div>
        <label>Фон (URL)</label><input type="text" id="bg-url" placeholder="URL картинки">

        <h2>Эффекты Виджета</h2>
        <label>Закругление углов (vmin)</label><input type="range" id="borderRadius" min="0" max="15" step="0.1" value="8">
        <label>Цвет Биллборда (Свечение)</label><input type="color" id="neon-color" value="#f9e076">

        <h2>Тексты и Язык</h2>
        <input type="text" id="start-title" value="Сокровища Пирата">
        <div class="color-grid">
            <select id="lang">
                <option value="ru">Русский</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
            <select id="fontFamily">
                <option value="'Segoe UI', sans-serif">Segoe UI</option>
                <option value="'Georgia', serif">Georgia</option>
            </select>
        </div>

        <h2>Уровни сложности</h2>
        <div id="levels-container"></div>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД IFRAME</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px; background:#fff; margin-top:20px;">ЗАКРЫТЬ</button>
</div>

<script>
const GITHUB_RAW = "https://raw.githubusercontent.com/lindtjulia1-web/Sparschwein1/main/";

// Инициализация
for(let i=1; i<=4; i++) {
    const lvlDiv = document.createElement('div');
    lvlDiv.innerHTML = `<h3>Уровень ${i}</h3><div id="q-container-lvl-${i}"></div><button class="btn" style="font-size:10px" onclick="addQ(${i})">+ Добавить вопрос</button>`;
    document.getElementById('levels-container').appendChild(lvlDiv);
}
addQ(1, "Вопрос 1 уровня?", "Верно", "Неверно");

function addQ(lvl, q="", c="", w="") {
    const container = document.getElementById(`q-container-lvl-${lvl}`);
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<input type="text" class="inp-q" value="${q}"><label>Ответы</label><input type="text" class="inp-correct" value="${c}"><input type="text" class="inp-wrong" value="${w}">`;
    container.appendChild(div);
}

function buildInnerGame() {
    const levels = [];
    for(let i=1; i<=4; i++) {
        const questions = Array.from(document.querySelectorAll(`#q-container-lvl-${i} .card`)).map(c => ({
            q: c.querySelector('.inp-q').value,
            a: [c.querySelector('.inp-correct').value, ...c.querySelector('.inp-wrong').value.split(',')]
        }));
        levels.push(questions);
    }

    const cfg = {
        bg: document.getElementById('bg-url').value,
        title: document.getElementById('start-title').value,
        br: document.getElementById('borderRadius').value,
        ff: document.getElementById('fontFamily').value,
        neon: document.getElementById('neon-color').value,
        levels: levels,
        pigs: [GITHUB_RAW+"1.png", GITHUB_RAW+"2.png", GITHUB_RAW+"3.png", GITHUB_RAW+"4.png", GITHUB_RAW+"5.png", GITHUB_RAW+"6.png"],
        coin: GITHUB_RAW+"7.png"
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: transparent; display: flex; align-items: center; justify-content: center; font-family: ${cfg.ff}; }
        #billboard-wrap { 
            width: 90%; height: 90%; /* Оставляем место для свечения снаружи */
            position: relative;
            border-radius: ${cfg.br}vmin;
            box-shadow: 0 0 5vmin ${cfg.neon}; 
            background: #000;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .bg { position: absolute; inset: 0; background: url(${cfg.bg}) center/cover; opacity: 0.4; z-index: 0; }
        .content { position: relative; z-index: 1; flex: 1; display: flex; flex-direction: column; padding: 5vmin; text-align: center; color: #fff; }
        .score { font-size: 8vmin; color: #f9e076; font-weight: 900; margin-top: 2vmin; }
        .pig-box { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; }
        .pig { height: 70%; object-fit: contain; }
        .q-area { min-height: 25vmin; display: flex; flex-direction: column; gap: 1.5vmin; justify-content: flex-end; }
        .q-text { font-size: 4vmin; font-weight: bold; margin-bottom: 2vmin; }
        button { background: #f9e076; border: none; padding: 2vmin; border-radius: 2vmin; font-weight: bold; font-size: 3.5vmin; cursor: pointer; }
        .screen { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .falling-coin { position: absolute; width: 6vmin; height: 6vmin; background: url(${cfg.coin}) center/cover; z-index: 5; pointer-events: none; }
        @keyframes fall { to { top: 50%; opacity: 0; transform: rotate(360deg); } }
    </style></head><body>
        <div id="billboard-wrap">
            <div class="bg"></div>
            <div id="start" class="screen">
                <h1 style="font-size:7vmin; color:#f9e076">${cfg.title}</h1>
                <button onclick="start()" style="padding:3vmin 8vmin; font-size:5vmin">В БОЙ</button>
            </div>
            <div class="content">
                <div class="score" id="s">0</div>
                <div class="pig-box"><img id="p" src="${cfg.pigs[0]}" class="pig"></div>
                <div class="q-area"><div class="q-text" id="qt"></div><div id="btns" style="display:grid; gap:1vmin"></div></div>
            </div>
        </div>
    <script>
        let sc=0, lvl=0, q=0; const c=${JSON.stringify(cfg)};
        function start(){ document.getElementById('start').style.display='none'; load(); }
        function load(){
            const d=c.levels[lvl][q]; if(!d) return end();
            document.getElementById('qt').innerText=d.q;
            const b=document.getElementById('btns'); b.innerHTML='';
            d.a.sort(()=>Math.random()-0.5).forEach(txt=>{
                const btn=document.createElement('button'); btn.innerText=txt;
                btn.onclick=()=>{ if(txt===d.a[0]){ sc+=100; document.getElementById('s').innerText=sc; drop(); } next(); };
                b.appendChild(btn);
            });
            document.getElementById('p').src=c.pigs[lvl]||c.pigs[0];
        }
        function next(){ q++; if(q>=c.levels[lvl].length){ lvl++; q=0; } if(lvl>=c.levels.length) end(); else load(); }
        function drop(){ for(let i=0;i<5;i++){ const m=document.createElement('div'); m.className='falling-coin'; m.style.left=Math.random()*80+10+'%'; m.style.top='-10%'; m.style.animation='fall 0.6s linear forwards'; document.body.appendChild(m); setTimeout(()=>m.remove(),600); } }
        function end(){ document.body.innerHTML='<div class="screen"><h1>ФИНАЛ</h1><h2 style="font-size:10vmin">'+sc+'</h2><button onclick="location.reload()">RESTART</button></div>'; }
    <\/script></body></html>`;
}

function updatePreview() {
    const w = document.getElementById('width').value, h = document.getElementById('height').value;
    const wrp = document.getElementById('device-wrapper');
    wrp.style.width = w+'px'; wrp.style.height = h+'px';
    const doc = document.getElementById('ifr').contentWindow.document;
    doc.open(); doc.write(buildInnerGame()); doc.close();
}

function getGeniallyCode() {
    const w = document.getElementById('width').value, h = document.getElementById('height').value;
    const content = buildInnerGame().replace(/<\/script>/g, '<\\/script>');
    document.getElementById('result-code').value = `<div style="width:100%; max-width:${w}px; aspect-ratio:${w}/${h}; margin:auto;">
    <iframe srcdoc="${content.replace(/"/g, '&quot;')}" style="width:100%; height:100%; border:none; background:transparent;" allowfullscreen></iframe>
</div>`;
    document.getElementById('code-modal').style.display = 'flex';
}
updatePreview();
</script>
</body>
</html>
