<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank - Stable Editor</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 20px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        .card { background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 15px; border-radius: 12px; margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        input, select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 6px; margin-top: 4px; font-size: 13px; outline: none; }
        .btn { border: none; padding: 14px; width: 100%; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        .btn-update { background: #ffb347; color: #000; }
        .btn-get { background: #77dd77; color: #000; }
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; }
        #wrap { position: relative; border: 1px dashed #333; }
        iframe { width: 100%; height: 100%; border: none; }
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; flex-direction: column; }
        textarea { width: 80%; height: 60%; background: #000; color: var(--accent); padding: 20px; border-radius: 15px; border: 1px solid var(--accent); font-family: monospace; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Настройки Экрана</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div><label>Ширина</label><input type="number" id="winW" value="400"></div>
            <div><label>Высота</label><input type="number" id="winH" value="600"></div>
        </div>
        <label>Фон (URL)</label><input type="text" id="bgImg" placeholder="Картинка пиратского клада">
        
        <h2>Оформление</h2>
        <label>Цвет Билборда</label><input type="color" id="neonCol" value="#f9e076">
        <label>Закругление</label><input type="range" id="round" min="0" max="80" value="40">
        
        <h2>Тексты</h2>
        <input type="text" id="titStart" value="Сокровища Пирата">
        <input type="text" id="btnStart" value="В БОЙ">
        <input type="text" id="titEnd" value="ЗОЛОТО ВАШЕ!">

        <div id="lvls"></div>
    </div>
    <div style="padding:20px; border-top:1px solid #3d3d45">
        <button class="btn btn-update" onclick="render()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-get" onclick="showCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview"><div id="wrap"><iframe id="prev"></iframe></div></div>

<div id="modal">
    <textarea id="res" readonly onclick="this.select()"></textarea>
    <button class="btn" style="width:200px; background:#fff" onclick="document.getElementById('modal').style.display='none'">ЗАКРЫТЬ</button>
</div>

<script>
const GIT = "https://raw.githubusercontent.com/lindtjulia1-web/Sparschwein1/main/";

// Рендер полей для уровней
for(let i=1; i<=4; i++) {
    const d = document.createElement('div');
    d.innerHTML = `<h3>Уровень ${i}</h3><div id="l-box-${i}"></div><button style="font-size:10px; padding:5px; width:100%" onclick="addQ(${i})">+ Вопрос</button>`;
    document.getElementById('lvls').appendChild(d);
}

function addQ(l, q="Легкий вопрос?", a="Да", w="Нет") {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<input type="text" class="q-in" value="${q}"><label>Верный</label><input type="text" class="a-in" value="${a}"><label>Ложный</label><input type="text" class="w-in" value="${w}">`;
    document.getElementById('l-box-'+l).appendChild(div);
}
addQ(1);

function generate() {
    const data = [];
    for(let i=1; i<=4; i++) {
        const qs = Array.from(document.querySelectorAll('#l-box-'+i+' .card')).map(c => ({
            q: c.querySelector('.q-in').value,
            a: [c.querySelector('.a-in').value, ...c.querySelector('.w-in').value.split(',')]
        }));
        data.push(qs);
    }

    const c = {
        bg: document.getElementById('bgImg').value,
        n: document.getElementById('neonCol').value,
        r: document.getElementById('round').value,
        ts: document.getElementById('titStart').value,
        bs: document.getElementById('btnStart').value,
        te: document.getElementById('titEnd').value,
        lvls: data
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:transparent; font-family:'Segoe UI',sans-serif; display:flex; align-items:center; justify-content:center; }
        #billboard-container { padding: 50px; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; box-sizing: border-box; }
        #game { 
            width: 100%; height: 100%; background: #000; position: relative; 
            border-radius: ${c.r}px; box-shadow: 0 0 40px ${c.n}; 
            display: flex; flex-direction: column; overflow: hidden;
        }
        .bg { position:absolute; inset:0; background:url(${c.bg}) center/cover; opacity:0.5; z-index:0; }
        .ui { position:relative; z-index:10; flex:1; display:flex; flex-direction:column; padding: 5vmin 8vmin; text-align:center; color:#fff; }
        .score { font-size:10vmin; color:#f9e076; font-weight:900; }
        .pig-zone { flex:1; display:flex; align-items:center; justify-content:center; }
        .pig { width:70vmin; height:auto; object-fit:contain; }
        .q-area { min-height:30%; display:flex; flex-direction:column; justify-content:flex-end; gap:2vmin; }
        button { background:#f9e076; border:none; padding:2.5vmin; border-radius:30px; font-weight:bold; font-size:4vmin; cursor:pointer; color:#000; }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .coin { position:absolute; width:8vmin; height:8vmin; background:url(${GIT}7.png) center/cover; z-index:50; pointer-events:none; }
        @keyframes drop { 0% { top:-10%; opacity:1; } 100% { top:50%; opacity:0; transform:rotate(360deg); } }
    </style></head><body>
        <div id="billboard-container">
            <div id="game">
                <div class="bg"></div>
                <div id="start" class="screen">
                    <h1 style="font-size:8vmin; color:#f9e076">${c.ts}</h1>
                    <button onclick="run()" style="width:60%">${c.bs}</button>
                </div>
                <div class="ui">
                    <div class="score" id="s">0</div>
                    <div class="pig-zone"><img id="p" src="${GIT}1.png" class="pig"></div>
                    <div class="q-area"><div id="qt" style="font-size:4.5vmin; font-weight:bold"></div><div id="ans" style="display:grid; gap:1.5vmin"></div></div>
                </div>
            </div>
        </div>
    <script>
        let sc=0, l=0, q=0; const cfg=${JSON.stringify(c)};
        function run(){ document.getElementById('start').style.display='none'; load(); }
        function load(){
            const curr = cfg.lvls[l][q]; if(!curr) return end();
            document.getElementById('qt').innerText = curr.q;
            const b = document.getElementById('ans'); b.innerHTML = '';
            [...curr.a].sort(()=>Math.random()-0.5).forEach(t => {
                const btn = document.createElement('button'); btn.innerText = t;
                btn.onclick = () => { if(t===curr.a[0]){ sc+=100; document.getElementById('s').innerText=sc; fx(); } next(); };
                b.appendChild(btn);
            });
            document.getElementById('p').src = '${GIT}' + (l+1) + '.png';
        }
        function next(){ q++; if(q>=cfg.lvls[l].length){ l++; q=0; } if(l>=cfg.lvls.length) end(); else load(); }
        function fx(){ for(let i=0; i<6; i++){ const m=document.createElement('div'); m.className='coin'; m.style.left=Math.random()*80+10+'%'; m.style.animation='drop 0.7s linear forwards'; document.body.appendChild(m); setTimeout(()=>m.remove(), 700); } }
        function end(){ document.body.innerHTML='<div class="screen"><h1>'+cfg.te+'</h1><h2 style="font-size:15vmin; color:#f9e076">'+sc+'</h2><button onclick="location.reload()">RESTART</button></div>'; }
    <\/script></body></html>`;
}

function render() {
    const w = document.getElementById('winW').value, h = document.getElementById('winH').value;
    const wrp = document.getElementById('wrap');
    wrp.style.width = w+'px'; wrp.style.height = h+'px';
    const d = document.getElementById('prev').contentWindow.document;
    d.open(); d.write(generate()); d.close();
}

function showCode() {
    const w = document.getElementById('winW').value, h = document.getElementById('winH').value;
    const clean = generate().replace(/<\/script>/g, '<\\/script>');
    document.getElementById('res').value = `<div style="width:100%; max-width:${w}px; margin:auto;"><div style="position:relative; padding-top:${(h/w)*100}%;"><iframe srcdoc="${clean.replace(/"/g, '&quot;')}" style="position:absolute; top:0; left:0; width:100%; height:100%; border:none; background:transparent;" allowfullscreen></iframe></div></div>`;
    document.getElementById('modal').style.display = 'flex';
}
render();
</script>
</body>
</html>
